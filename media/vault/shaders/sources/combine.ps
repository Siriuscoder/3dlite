#version 330

uniform sampler2D lightMap;
uniform sampler2D diffuseMap;

uniform vec3 eye;

in vec2 iuv;

const vec3 ambient = vec3(0.02, 0.02, 0.02);

vec3 blinn_calculate(samplerBuffer source, int num, vec3 ambient, vec3 fragPos, 
    vec3 fragNormal, vec3 eye, float specularFactor, 
    float wrapAroundFactor, float specPower);

void main()
{
    /* fragment coordinate */
    vec4 diff = texture2D(diffuseMap, iuv);
    /* check fragment not shaded or self-illum material */
    if (diff.w == 1.0)
    {
        gl_FragColor = vec4(diff.xyz, 1.0);
        return;
    }

    vec3 linear = texture2D(lightMap, iuv).rgb;
    /* result color in LDR */
    gl_FragColor = vec4(diff.rgb * (ambient + linear), 1.0);
    //gl_FragColor = vec4(linear, 1.0);
}